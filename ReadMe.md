# RPGBattleAI

# 概要

ターン制RPGの戦闘バランス調整のためのテストプレイを、機械学習を用いて自動化する方法を研究するためのアプリです。

# 研究の背景と目的

ゲーム開発においてゲームバランスを調整する際、必ずテストプレイを行います。ゲームの操作は大変複雑なため、テストプレイを自動化するのは難しく、多くの場合は人の手でテストが行われます。ゲームによっては自動化できる場合もありますが、自動化のためのAIは通常、一つのゲーム専用のAIとして作成され、他のゲームのテストプレイに流用できることはほぼありません。もしも、ゲームの種類を問わずテストプレイを自動で行うAIを作ることができれば、ゲームバランス調整作業が格段に効率化されるはずです。

テストプレイを自動化できる可能性のある機械学習の手法の一つが「深層強化学習」です。深層強化学習は「行動を学習する」ことに長けた手法です。ゲームに当てはめると、ゲームを攻略するための最適な「行動を学習する」ことが可能です。あらゆるゲームを汎用的に学習することは難しいですが、深層強化学習が得意とするジャンルに絞ることで、現在の深層強化学習の学習能力でも十分なテストプレイを行える可能性があります。

そこで、深層強化学習を用いてターン制RPGの戦闘を自動で学習し、テストプレイを行う方法を研究するため、このアプリを作成しました。

なお、このアプリでは簡単のため、1対1の戦闘のみを対象としています。

# アプリ構成

現在、本プロジェクトに格納されているアプリは以下の3種類です。

| ファイル名 | 説明 |
| ---- | ---- |
| RPGTurnBattle.py | AIがテストプレイを行う対象の、ターン制RPG戦闘プログラムです。<br>ゲーム内容の詳細は後述します。 |
| ExecuteSimulation.py | RPGTurnBattle.pyを人間がプレイするためのプログラムです。 |
| AIPlayer/DQNPlayer.py | DQNで深層強化学習を行うエージェントのプログラムです。<br>学習パラメータを指定して学習を行うことが可能です。 |

# テスト対象のゲーム内容

1対1のターン制RPGです。ランダムに現れるモンスターと10回戦闘を行い、より多くの戦闘に勝利しつつ、10回の戦闘を生き残ることを目指します（逃走も可能です）。深層強化学習においては、ゲームの目的を達成する行動に対して報酬（得点）を設定する必要があるため、以下の通り報酬の配分を設定します。

- 敵に勝利する：+1
- 10回の戦闘を生き残る：+10
- 戦闘に敗北する：-20

上記配分は、RPGにおいて「町から出て、敵と戦いながら次の町にたどり着けること」を模しています。RPGでは、戦闘に勝利することで少しずつ「所持金が増える」「経験値を得られる」等の小さなメリットがあります。また、新しい町にたどり着くことで、シナリオを進めたり強力な武器防具を購入できるなど、大きなメリットが得られます。一方、戦闘に敗北した場合は「所持金が半分になる」「セーブ地点からやり直す」など、非常に大きなデメリットを被ることがほとんどです。こうしたRPGの特徴を得点として表したのが上記ルールです。

AIにはゲーム攻略に必要な情報として、主人公のステータスや敵のステータス等の数値が配列として与えられます。ただし、それらの数値がそれぞれ何を意味しているかという情報は与えられません（補足情報として、一般的なRPGを模したメッセージも伝えられますが、AIの学習には利用しません）。AIは何度も戦闘を繰り返すうちに、与えられたステータスに対して取るべき行動を学習していきます。最後には10回の戦闘すべてに勝利する方法（獲得報酬を最大化する方法）を学習することを目指します。

なお、ゲーム開始時に主人公のレベルを指定することができます。RPGでは通常、各敵キャラクターに対して主人公の推奨レベルが設定されています。そこでこのゲームでは、最初に主人公のレベルを設定することで、そのレベルに適した敵が現れるようにしています。

# 機械学習の実行方法

RPGTurnBattleWithAI.ipynb を開くと、google corabolatory を利用したアプリの使用方法が記載されていますので、そちらを参照ください。なお.ipynbをそのまま実行すると、学習に10～20分ほどかかりますのでご注意ください。
